# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches:
      - policy_app
jobs:
  build_and_deploy:
    runs-on: self-hosted
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - run: npm i --force
      - run: npm run build-prod
      - name: zip file
        run: |
          cd dist          
          zip -r policy.zip *
          ls -liah      
          echo `pwd`            
          echo `pwd`
          ls -liah
          scp policy.zip ttc-admin@fo889.firecloud.live:/tmp/.
          c=$(ssh ttc-admin@fo889.firecloud.live 'rm -rf /static/fo69/policy/') || true
          ssh ttc-admin@fo889.firecloud.live 'unzip /tmp/policy.zip -d /static/fo69/policy'
  cms-send-msg:
    runs-on: ubuntu-latest
    needs: build_and_deploy
    steps:
      - name: send telegram after build
        uses: appleboy/telegram-action@master
        with:
          to: -743606982
          token: 374431260:AAEj6smsnegEmmQc3bjuMWy9edKZnf5VEi0
          message: |
            ${{ github.actor }} done build for policy page
            Commit message: ${{ github.event.commits[0].message }}
            Repository: ${{ github.repository }}
            policy page updated !! check index page for new feature or bugs fixed
